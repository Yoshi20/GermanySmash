.row.title-div
  .col-md-12
    %h1= @tournament.name

.row.show-tournament
  .col-md-4
    %p
      %strong Date:
      = @tournament.date.to_s(:custom_datetime_with_weekday)

    %p
      %strong Location:
      %br
      - @tournament.location.split(',').each do |str|
        &emsp;
        = str.strip
        %br

    %p
      %strong Started:
      %input{type: 'checkbox', checked: @tournament.started, disabled: 'true'}

      &emsp;
      %strong Finished:
      %input{type: 'checkbox', checked: @tournament.finished, disabled: 'true'}

      &emsp;
      %strong Active:
      %input{type: 'checkbox', checked: @tournament.active, disabled: 'true'}

  .col-md-4
    %p
      %strong Registration deadline:
      = registration_deadline(@tournament.date).to_s(:custom_datetime_with_weekday)

    %p
      %strong Registration fee:
      = @tournament.registration_fee
      = 'CHF'

    %p
      %strong Occupied seats:
      = @tournament.occupied_seats

    %p
      %strong Total seats:
      = @tournament.total_seats

    %p
      %strong Updated at:
      = @tournament.updated_at.to_s(:custom_datetime)

    %p
      %strong Created at:
      = @tournament.created_at.to_s(:custom_datetime)

  .col-md-4
    - if current_user.admin?
      %p= link_to 'Edit', edit_tournament_path(@tournament)
      %p= link_to 'Delete', @tournament, method: :delete, data: { confirm: 'Are you sure?' }
    %p= link_to 'Back', :back

.row.tournament-description
  .col-md-12
    %p
      %strong Descripton:
      %br
      = @tournament.description

- if @tournament.started != true and @tournament.finished != true
  .row.join-tournament
    %br
    .col-md-4
      - if Time.now > registration_deadline(@tournament.date)
        %p= button_to "Registration deadline exceeded", tournament_path(@tournament.id), params:{add_player:true}, method:'patch', class:'btn btn-primary', id:'join-tournament-button', disabled:true
      -else
        - if current_user.player.tournaments.include?(@tournament)
          %p= button_to ">>> Leave this tournament <<<", tournament_path(@tournament.id), params:{remove_player:true}, method:'patch', class:'btn btn-warning', id:'leave-tournament-button'
        - else
          %p= button_to ">>> Join this tournament <<<", tournament_path(@tournament.id), params:{add_player:true}, method:'patch', class:'btn btn-success', id:'join-tournament-button'

    - if current_user.admin?
      .col-md-4
        %p
          = form_tag tournament_path(@tournament.id), method:'patch', class: 'form-inline' do
            .hidden= text_field_tag :add_player, true, class: 'form-control'
            = text_field_tag :gamer_tag, params[:gamer_tag], class: 'form-control'
            = submit_tag 'Add player', name:nil, class: 'form-control btn btn-default'

      .col-md-4
        %p
          = form_tag tournament_path(@tournament.id), method:'patch', class: 'form-inline' do
            .hidden= text_field_tag :remove_player, true, class: 'form-control'
            = text_field_tag :gamer_tag, params[:gamer_tag], class: 'form-control'
            = submit_tag 'Remove player', name:nil, class: 'form-control btn btn-default'

.row.title-registered-players-tournament-ranking
  .col-md-6
    .row.title-registered-players
      .col-md-12
        %h2 Registered players
        .row.show-registered-players
          .col-md-12
            - @tournament.players.each_with_index do |p, i|
              %p
                = "##{i+1}"
                %strong= link_to "#{p.gamer_tag}", p

  .col-md-6
    - if @tournament.started and @tournament.finished
      .row.title-tournament-ranking
        .col-md-12
          %h2 Tournament ranking
          .row.show-tournament-ranking
            .col-md-12
              - unless @tournament.ranking_string.nil?
                - @tournament.ranking_string.split(';').sort.each do |r|
                  %p
                    - ranking = r.split(',')
                    %strong= "#{ranking[0]}. #{ranking[1]} (#{points_repartition_table(ranking[0].to_i)}p)"

- if @tournament.started
  .row.challonge_tournament_tree
    .col-md-12
      %img{:src => "https://challonge.com/#{@tournament.name.gsub(/( )/, '_').downcase}.svg"}

- if current_user.admin?
  .row.admin-tournament
    .col-md-12
      %br
      - if @tournament.started
        %p
          = link_to 'Show challonge tournament tree', "https://challonge.com/de/#{@tournament.name.gsub(/( )/, '_').downcase}", target: '_blank', class:'btn btn-primary'
          - unless @tournament.finished
            = button_to "Finish tournament", "/tournaments/finish/#{@tournament.id}", class:'btn btn-danger', id:'finish-tournament-button', :data => {:confirm => 'Are you sure?'}
      - elsif @tournament.finished != true
        %p= button_to "Start tournament", "/tournaments/start/#{@tournament.id}", class:'btn btn-danger', id:'start-tournament-button', :data => {:confirm => 'Are you sure?'}
